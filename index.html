<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMT Diagnostics Presentation</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Heebo', sans-serif; background-color: #f8fafc; overflow: hidden; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        /* Loading Spinner */
        #loader {
            position: fixed; inset: 0; background: white; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .spin { width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top: 4px solid #2563eb; border-radius: 50%; animation: s 1s linear infinite; }
        @keyframes s { to { transform: rotate(360deg); } }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.0/Recharts.min.js"></script>
    
    <script src="https://unpkg.com/lucide-react@0.344.0/dist/umd/lucide-react.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.10/babel.min.js"></script>
</head>
<body>

    <div id="loader">
        <div class="spin"></div>
        <p class="mt-4 text-slate-500">טוען מצגת...</p>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        // --- Error Recovery & Setup ---
        
        // Wait for libraries to be available
        const waitForLibraries = () => {
            return new Promise((resolve, reject) => {
                let attempts = 0;
                const check = setInterval(() => {
                    attempts++;
                    const hasReact = !!window.React;
                    const hasRecharts = !!window.Recharts;
                    const hasLucide = !!window.lucideReact;

                    if (hasReact && hasRecharts && hasLucide) {
                        clearInterval(check);
                        resolve();
                    }
                    
                    if (attempts > 50) { // 5 seconds timeout
                        clearInterval(check);
                        console.warn("Libraries missing:", { React: hasReact, Recharts: hasRecharts, Lucide: hasLucide });
                        // Don't reject, try to run anyway with fallbacks
                        resolve(); 
                    }
                }, 100);
            });
        };

        // --- Main Logic Start ---
        waitForLibraries().then(() => {
            // Hide Loader
            document.getElementById('loader').style.display = 'none';
            
            // --- Destructuring ---
            const { useState, useMemo, useRef, useEffect } = React;
            
            // Recharts fallback to empty object if missing to prevent crash
            const Recharts = window.Recharts || {};
            const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } = Recharts;

            // Lucide fallback function
            const getIcon = (name) => {
                if (window.lucideReact && window.lucideReact[name]) return window.lucideReact[name];
                return () => <span className="text-xs bg-gray-200 px-1 rounded">Icon</span>;
            };

            // Map all icons
            const ChevronLeft = getIcon('ChevronLeft');
            const ChevronRight = getIcon('ChevronRight');
            const Activity = getIcon('Activity');
            const Microscope = getIcon('Microscope');
            const TrendingUp = getIcon('TrendingUp');
            const ShieldCheck = getIcon('ShieldCheck');
            const Stethoscope = getIcon('Stethoscope');
            const FlaskConical = getIcon('FlaskConical');
            const ArrowRightCircle = getIcon('ArrowRightCircle');
            const CheckCircle2 = getIcon('CheckCircle2');
            const Smartphone = getIcon('Smartphone');
            const Scan = getIcon('Scan');
            const Database = getIcon('Database');
            const BrainCircuit = getIcon('BrainCircuit');
            const HeartPulse = getIcon('HeartPulse');
            const Calculator = getIcon('Calculator');
            const Lock = getIcon('Lock');
            const Sparkles = getIcon('Sparkles');
            const Loader2 = getIcon('Loader2');
            const MessageSquareQuote = getIcon('MessageSquareQuote');
            const Bot = getIcon('Bot');
            const X = getIcon('X');

            // --- Gemini API Key ---
            const apiKey = ""; 

            const generateGeminiContent = async (prompt) => {
                if (!apiKey) return "נא להגדיר מפתח API בקוד.";
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    if (!response.ok) throw new Error('Network error');
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "שגיאה בתשובה.";
                } catch (error) {
                    console.error("Gemini Error:", error);
                    return "אירעה שגיאה בתקשורת.";
                }
            };

            // --- Components ---

            const Header = ({ currentSlide, totalSlides }) => (
                <div className="fixed top-0 left-0 right-0 h-16 bg-white shadow-sm z-50 flex items-center justify-between px-8 border-b border-gray-100 font-sans" dir="rtl">
                    <div className="flex items-center gap-3">
                        <div className="h-10 w-10 bg-blue-600 text-white flex items-center justify-center font-bold rounded shadow-sm">BMT</div>
                        <span className="text-xl font-bold text-gray-800 tracking-tight hidden md:block">BMT Diagnostics</span>
                    </div>
                    <div className="flex items-center gap-4">
                        <div className="hidden md:flex gap-1">
                            {Array.from({ length: totalSlides }).map((_, i) => (
                                <div key={i} className={`h-1.5 rounded-full transition-all duration-300 ${i === currentSlide ? 'w-8 bg-blue-600' : 'w-2 bg-gray-200'}`} />
                            ))}
                        </div>
                        <span className="text-sm font-medium text-gray-500">שקף {currentSlide + 1} מתוך {totalSlides}</span>
                    </div>
                </div>
            );

            const SlideContainer = ({ children, className = "" }) => (
                <div className={`w-full h-full flex flex-col pt-20 pb-24 px-4 md:px-16 max-w-7xl mx-auto overflow-y-auto custom-scroll ${className}`}>
                    {children}
                </div>
            );

            const AIAssistant = () => {
                const [isOpen, setIsOpen] = useState(false);
                const [messages, setMessages] = useState([{ role: 'system', text: 'שלום! אני העוזר הווירטואלי של BMT. איך אני יכול לעזור?' }]);
                const [input, setInput] = useState('');
                const [isTyping, setIsTyping] = useState(false);
                const chatEndRef = useRef(null);

                useEffect(() => chatEndRef.current?.scrollIntoView({ behavior: "smooth" }), [messages, isOpen]);

                const handleSend = async () => {
                    if (!input.trim()) return;
                    const userMsg = input;
                    setMessages(prev => [...prev, { role: 'user', text: userMsg }]);
                    setInput('');
                    setIsTyping(true);
                    
                    const prompt = `You are a sales assistant for BMT Diagnostics. Answer in Hebrew. Question: ${userMsg}`;
                    const reply = await generateGeminiContent(prompt);
                    
                    setIsTyping(false);
                    setMessages(prev => [...prev, { role: 'system', text: reply }]);
                };

                return (
                    <React.Fragment>
                        <button onClick={() => setIsOpen(!isOpen)} className="fixed bottom-6 left-6 z-[60] bg-indigo-600 text-white p-4 rounded-full shadow-2xl hover:scale-105 transition-transform">
                            {isOpen ? <X size={24} /> : <Bot size={24} />}
                        </button>
                        {isOpen && (
                            <div className="fixed bottom-24 left-6 z-[60] w-80 md:w-96 bg-white rounded-2xl shadow-xl border border-gray-200 flex flex-col h-[450px]" dir="rtl">
                                <div className="bg-indigo-600 p-4 text-white flex items-center gap-2 rounded-t-2xl font-bold"><Sparkles size={18}/> BMT AI</div>
                                <div className="flex-1 overflow-y-auto p-4 bg-slate-50 space-y-4">
                                    {messages.map((msg, idx) => (
                                        <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-start' : 'justify-end'}`}>
                                            <div className={`max-w-[85%] p-3 rounded-2xl text-sm ${msg.role === 'user' ? 'bg-white border text-slate-800' : 'bg-indigo-600 text-white'}`}>{msg.text}</div>
                                        </div>
                                    ))}
                                    {isTyping && <div className="text-xs text-gray-400 text-center">מקליד...</div>}
                                    <div ref={chatEndRef}/>
                                </div>
                                <div className="p-3 border-t flex gap-2">
                                    <input value={input} onChange={e => setInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && handleSend()} className="flex-1 px-4 py-2 bg-slate-100 rounded-full text-sm outline-none" placeholder="שאל משהו..." />
                                    <button onClick={handleSend} className="bg-indigo-600 text-white p-2 rounded-full"><ArrowRightCircle size={20} style={{transform:'rotate(180deg)'}}/></button>
                                </div>
                            </div>
                        )}
                    </React.Fragment>
                );
            };

            // --- Slides Definitions ---

            const CoverSlide = ({ nextSlide }) => (
                <SlideContainer className="justify-center items-center text-center">
                    <div className="bg-blue-50 text-blue-600 px-4 py-1 rounded-full text-sm font-semibold mb-6">מהפכת הדיאגנוסטיקה הביתית</div>
                    <h1 className="text-5xl md:text-7xl font-black text-slate-900 mb-6 font-sans">
                        שותפות אסטרטגית <br/><span className="text-blue-600">לרפואה מונעת דיגיטלית</span>
                    </h1>
                    <p className="text-xl text-slate-600 max-w-3xl mb-10 font-light">פתרון AI מתקדם המשלב בדיקות ביתיות מדויקות עם אפליקציה חכמה.</p>
                    <button onClick={nextSlide} className="bg-blue-600 text-white text-xl px-10 py-4 rounded-full font-bold shadow-lg flex items-center gap-3">
                        גלה את הפתרון <ArrowRightCircle />
                    </button>
                </SlideContainer>
            );

            const StrategySlide = () => (
                <SlideContainer>
                    <div className="flex flex-col md:flex-row gap-12 items-center h-full">
                        <div className="flex-1 space-y-6">
                            <h2 className="text-4xl font-bold text-slate-800 border-r-4 border-blue-600 pr-4">האתגר הלאומי</h2>
                            <ul className="space-y-6">
                                <li className="flex gap-4"><div className="bg-red-100 p-2 rounded text-red-600"><TrendingUp /></div><div><h3 className="font-bold">גילוי מוקדם</h3><p>שיעורי ביצוע נמוכים בגלל חוסר נוחות.</p></div></li>
                                <li className="flex gap-4"><div className="bg-orange-100 p-2 rounded text-orange-600"><Activity /></div><div><h3 className="font-bold">עומס תורים</h3><p>המתנה ארוכה לגסטרואנטרולוגים.</p></div></li>
                            </ul>
                        </div>
                        <div className="flex-1 w-full bg-white p-8 rounded-2xl shadow-xl h-64">
                            <h3 className="text-center font-bold mb-4">עלות טיפול בסרטן (₪)</h3>
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={[{name:'מוקדם', cost:30000}, {name:'מאוחר', cost:350000}]}>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false}/>
                                    <XAxis dataKey="name" />
                                    <Tooltip />
                                    <Bar dataKey="cost" fill="#ef4444" radius={[4,4,0,0]} barSize={60}/>
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                </SlideContainer>
            );

            const DigitalSolutionSlide = () => (
                <SlideContainer>
                    <div className="mb-10 text-center"><h2 className="text-4xl font-bold">הפתרון הדיגיטלי</h2></div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                        <div className="bg-white p-6 rounded-3xl shadow border flex flex-col items-center">
                            <div className="bg-blue-100 p-4 rounded-full text-blue-600 mb-4"><Scan size={40}/></div>
                            <h3 className="text-2xl font-bold mb-2">סריקה</h3>
                            <p>ביצוע בדיקה בבית וסריקה באפליקציה.</p>
                        </div>
                        <div className="bg-white p-6 rounded-3xl shadow border flex flex-col items-center">
                            <div className="bg-indigo-100 p-4 rounded-full text-indigo-600 mb-4"><BrainCircuit size={40}/></div>
                            <h3 className="text-2xl font-bold mb-2">פענוח AI</h3>
                            <p>דיוק העולה על העין האנושית ומניעת טעויות.</p>
                        </div>
                        <div className="bg-white p-6 rounded-3xl shadow border flex flex-col items-center">
                            <div className="bg-teal-100 p-4 rounded-full text-teal-600 mb-4"><Database size={40}/></div>
                            <h3 className="text-2xl font-bold mb-2">סגירת מעגל</h3>
                            <p>שידור מוצפן לתיק הרפואי וקביעת תור.</p>
                        </div>
                    </div>
                </SlideContainer>
            );

            const FOBEconomicsSlide = () => {
                const [targetPop, setTargetPop] = useState(50000);
                const [baseCompliance, setBaseCompliance] = useState(60);
                const [appBoost, setAppBoost] = useState(15);
                const [aiSummary, setAiSummary] = useState('');
                const [loading, setLoading] = useState(false);
                
                const savings = Math.floor(targetPop * ((baseCompliance + appBoost)/100) * 0.003 * 150000);

                const getSummary = async () => {
                    setLoading(true);
                    const prompt = `נתונים: אוכלוסייה ${targetPop}, חיסכון ${savings}. כתוב משפט סיכום משכנע למנהל.`;
                    const res = await generateGeminiContent(prompt);
                    setAiSummary(res);
                    setLoading(false);
                };

                return (
                    <SlideContainer>
                        <h2 className="text-4xl font-bold mb-6">מחשבון חיסכון FOB</h2>
                        <div className="flex flex-col lg:flex-row gap-8">
                            <div className="flex-1 bg-white p-6 rounded-2xl shadow border space-y-6">
                                <div><label>אוכלוסייה: {targetPop}</label><input type="range" min="10000" max="200000" step="5000" value={targetPop} onChange={e=>setTargetPop(Number(e.target.value))} className="w-full"/></div>
                                <div><label>היענות בסיס: {baseCompliance}%</label><input type="range" min="30" max="80" value={baseCompliance} onChange={e=>setBaseCompliance(Number(e.target.value))} className="w-full"/></div>
                                <div><label>תוספת אפליקציה: +{appBoost}%</label><input type="range" min="5" max="30" value={appBoost} onChange={e=>setAppBoost(Number(e.target.value))} className="w-full accent-green-500"/></div>
                            </div>
                            <div className="flex-1 space-y-4">
                                <div className="bg-white p-6 rounded-2xl border-t-4 border-green-500 text-center">
                                    <div className="text-gray-500">חיסכון שנתי משוער</div>
                                    <div className="text-5xl font-black text-green-600">₪{savings.toLocaleString()}</div>
                                </div>
                                <div className="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="font-bold text-indigo-700 flex items-center gap-2"><Sparkles size={16}/> AI Analysis</span>
                                        <button onClick={getSummary} className="bg-indigo-600 text-white text-xs px-3 py-1 rounded-full">{loading ? '...' : 'נתח'}</button>
                                    </div>
                                    <p className="text-sm text-slate-700 min-h-[60px]">{aiSummary || 'לחץ לקבלת ניתוח'}</p>
                                </div>
                            </div>
                        </div>
                    </SlideContainer>
                );
            };

            const CalprotectinSlide = () => (
                <SlideContainer>
                    <h2 className="text-4xl font-bold mb-2">Calprotectin</h2>
                    <p className="text-xl text-slate-500 mb-8">סינון חכם המבדיל בין IBD ל-IBS</p>
                    <div className="grid grid-cols-2 gap-6">
                        <div className="bg-white p-6 rounded-xl shadow border-r-4 border-indigo-500">
                            <h3 className="font-bold text-lg mb-2">המצב כיום</h3>
                            <p>כל תלונה על כאב בטן נשלחת לקולונוסקופיה יקרה (2,500 ₪).</p>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow border-r-4 border-green-500">
                            <h3 className="font-bold text-lg mb-2">עם BMT</h3>
                            <p>בדיקה ביתית פשוטה מסננת 50% מהמקרים (IBS) וחוסכת תורים.</p>
                        </div>
                    </div>
                </SlideContainer>
            );

            const ProductSuiteSlide = () => (
                <SlideContainer>
                    <h2 className="text-4xl font-bold mb-8">פורטפוליו בדיקות</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="bg-white p-6 rounded-2xl shadow border-r-4 border-teal-500">
                            <h3 className="text-2xl font-bold mb-4 flex items-center gap-2"><FlaskConical/> גסטרו</h3>
                            <ul className="space-y-2">
                                <li>• <strong>H. Pylori:</strong> אנטיגן בצואה, מחליף נשיפה.</li>
                                <li>• <strong>Calprotectin:</strong> סמן דלקת רגיש.</li>
                            </ul>
                        </div>
                        <div className="bg-white p-6 rounded-2xl shadow border-r-4 border-rose-500">
                            <h3 className="text-2xl font-bold mb-4 flex items-center gap-2"><Stethoscope/> משפחה</h3>
                            <ul className="space-y-2">
                                <li>• <strong>Covid + Flu:</strong> בדיקה משולבת.</li>
                                <li>• <strong>Strep A:</strong> זיהוי דלקת גרון.</li>
                            </ul>
                        </div>
                    </div>
                </SlideContainer>
            );

            const SummarySlide = () => (
                <SlideContainer className="justify-center items-center text-center">
                    <div className="w-full max-w-4xl bg-slate-900 text-white p-12 rounded-3xl shadow-2xl">
                        <Activity size={48} className="mx-auto mb-6 text-blue-400"/>
                        <h2 className="text-4xl font-bold mb-6">העתיד כבר כאן</h2>
                        <p className="text-xl text-slate-300 mb-8">דיוק קליני, חיסכון כלכלי ושירות טוב יותר למבוטח.</p>
                        <div className="grid grid-cols-3 gap-4 text-center">
                            <div className="bg-white/10 p-4 rounded-xl"><h3>קליני</h3><span className="text-sm text-gray-400">דיוק ומניעת טעויות</span></div>
                            <div className="bg-white/10 p-4 rounded-xl"><h3>כלכלי</h3><span className="text-sm text-gray-400">חיסכון בטיפולים</span></div>
                            <div className="bg-white/10 p-4 rounded-xl"><h3>שירות</h3><span className="text-sm text-gray-400">זמינות ונוחות</span></div>
                        </div>
                    </div>
                </SlideContainer>
            );

            // --- App Main ---

            const App = () => {
                const [slide, setSlide] = useState(0);
                const slides = [CoverSlide, StrategySlide, DigitalSolutionSlide, FOBEconomicsSlide, CalprotectinSlide, ProductSuiteSlide, SummarySlide];
                const Component = slides[slide];

                return (
                    <div className="w-full h-screen bg-slate-50 flex flex-col font-sans" dir="rtl">
                        <Header currentSlide={slide} totalSlides={slides.length} />
                        <div className="flex-1 relative overflow-hidden animate-[fadeIn_0.5s]">
                            <Component nextSlide={() => setSlide(s => Math.min(s+1, slides.length-1))} />
                        </div>
                        <AIAssistant />
                        <div className="h-20 bg-white border-t flex items-center justify-between px-8">
                            <button onClick={()=>setSlide(s=>Math.max(0, s-1))} disabled={slide===0} className="px-6 py-2 rounded-full hover:bg-slate-100 disabled:opacity-50"><ChevronRight/> הקודם</button>
                            <button onClick={()=>setSlide(s=>Math.min(slides.length-1, s+1))} disabled={slide===slides.length-1} className="px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 flex gap-2">{slide===slides.length-1?'סיום':'הבא'} <ChevronLeft/></button>
                        </div>
                    </div>
                );
            };

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        });
    </script>
</body>
</html>
